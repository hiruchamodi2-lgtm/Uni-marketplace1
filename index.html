<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Uni Marketplace</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 30px auto; }
    h1 { text-align: center; }
    .ad { border: 1px solid #ccc; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
    img { max-width: 100%; border-radius: 8px; }
    button { background: red; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Uni Marketplace</h1>

  <div>
    <h3>Post Your Ad</h3>
    <input type="text" id="title" placeholder="Ad Title"><br><br>
    <textarea id="desc" placeholder="Description"></textarea><br><br>
    <input type="file" id="imageInput"><br><br>
    <input type="text" id="username" placeholder="Your Name"><br><br>
    <button onclick="postAd()">Post Ad</button>
  </div>

  <h3>All Ads</h3>
  <div id="ads"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <script>
    // Replace this with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function postAd() {
      const title = document.getElementById('title').value;
      const desc = document.getElementById('desc').value;
      const username = document.getElementById('username').value;
      const file = document.getElementById('imageInput').files[0];

      if (!title || !desc || !username) {
        alert("Please fill all fields");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const imageUrl = e.target.result;
        const newAdRef = db.ref('ads').push();
        newAdRef.set({
          title, desc, username, imageUrl
        });
      };
      if (file) reader.readAsDataURL(file);
      else {
        const newAdRef = db.ref('ads').push();
        newAdRef.set({ title, desc, username, imageUrl: "" });
      }
    }

    function deleteAd(id, username) {
      const currentUser = prompt("Enter your name to confirm delete:");
      if (currentUser === username) {
        db.ref('ads/' + id).remove();
      } else {
        alert("You can delete only your own ads!");
      }
    }

    // Display all ads
    db.ref('ads').on('value', snapshot => {
      const adsDiv = document.getElementById('ads');
      adsDiv.innerHTML = "";
      snapshot.forEach(child => {
        const ad = child.val();
        const adDiv = document.createElement('div');
        adDiv.className = 'ad';
        adDiv.innerHTML = `
          <h4>${ad.title}</h4>
          <p>${ad.desc}</p>
          ${ad.imageUrl ? `<img src="${ad.imageUrl}">` : ""}
          <p><b>Posted by:</b> ${ad.username}</p>
          <button onclick="deleteAd('${child.key}', '${ad.username}')">Delete</button>
        `;
        adsDiv.appendChild(adDiv);
      });
    });
  </script>
</body>
</html>
